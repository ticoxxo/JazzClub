@using JazzClub.Models.Helpers
@model IEnumerable<Student>

@{
	ViewBag.Title = "Students";
}

<div class="text-center">
	<h1 class="display-4">Students</h1>
</div>

<a asp-action="Add">Agregar estudiante</a>
<a >Agregar pago</a>
<a >Inscribir a clase</a>

<table class="table">
	<thead>
		<tr>
			<th>Name</th>
			<th>Cellphone</th>
			<th>Pagos</th>
			<th>Foto</th>
			<th class="d-none d-sm-table-cell">Tutor</th>
			<th>Status</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		@foreach (Student student in Model)
		{
			<tr>
				<td>@student.FullName</td>
				<td>@student.Cellphone</td>
				<td>
					@{
						if(student.LastPayment == null)
						{
							<p>No hay pagos registrados</p>
							<a asp-action="AddPayment"
							   asp-controller="Student"
							   asp-route-id="@student.Id"
							   class="btn btn-outline-dark">Agregar pago</a>
						} 
						else
						{
						
							<p>Ultimo pago:</p>
							<ul>
								<li>Total: @student.LastPayment.Total</li>
								<li>Fecha de pago: @student.LastPayment.PaymentDate</li>
								<li>Expide en: @student.LastPayment.PaymentExpirationDate</li>
							</ul>
						}
					}
				</td>
				<td>
					@{
						 string imgSrc;
						if (student.Photo == null)
						{
						imgSrc = "~/Images/image2.png";
						} else
						{
						var base64 = Convert.ToBase64String(student.Photo);
						imgSrc = String.Format("data:image/jpg;base64,{0}", base64);
						}
						 
						//var base64 = Convert.ToBase64String(student.Photo);
						//var imgSrc = String.Format("data:image/jpg;base64,{0}", base64);
						
					}
					<img src="@imgSrc" style="width:200px; height:200px" class="img-fluid img-thumbnail d-none d-sm-block" asp-append-version="true" />
					<img src="@imgSrc" class="img-fluid img-thumbnail d-block d-sm-none" asp-append-version="true" />
				</td>
				<td class="d-none d-sm-table-cell">
					@if(student.GuardianId != null)
					{
						<ul>
							<li><p>@student.Guardian.Name</p></li>
							<li hidden="@(student.Guardian.Cellphone == null ? true : false)">@student.Guardian.Cellphone</li>
							<li hidden="@(student.Guardian.Email == null ? true : false)">@student.Guardian.Email</li>
						</ul>
					} 
					else
					{
						<p>N/A</p>
					}
				</td>
				<td>
					<p style="color:@StatusHelper.ChooseColor(@student.Status)">@StatusHelper.ShowStatus(student.Status)</p>
				</td>
				<td>
					<a asp-action="Edit" asp-controller="Student" asp-route-id="@student.Id" class="btn btn-outline-dark">
						Editar
					</a>
					<a asp-action="Delete" asp-route-id="@student.Id" class="btn btn-outline-dark">
						Delete
					</a>
				</td>
			</tr>
		}
	</tbody>
</table>